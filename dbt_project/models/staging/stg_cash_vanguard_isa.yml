version: 2

models:
    - name: stg_cash_vanguard_isa
      description: "A ledger of cash movements within the Vanguard ISA account. Used to track uninvested cash balances and interest payments. 
                    Each row represents a cash-in or cash-out event."
      columns:
        - name: transfer_dt
          description: "Transfert date where the account balance changed."
          tests:
            - not_null
        - name: customer_email_txt
          description: "Email of the portfolio owner."
          tests:
            - not_null
            - relationships:
                to: ref('stg_dim_customer')
                field: customer_email_txt
        - name: company_number_key
          description: "Company number of the financial institution executing the transaction."
          tests:
            - not_null
        - name: company_number_system_cd
          description: "Local system used by the country of domiciliation to identify a company - such as SIRET in France, CRN in the UK."
          tests:
            - not_null
        # Virtual Column test for composite natural key
        - name: "company_number_key || '-' || company_number_system_cd"
          description: "Composite natural key link to dim_company"
          tests:
            - relationships:
                to: ref('stg_dim_company')
                field: "company_number_key || '-' || company_number_system_cd"
        - name: wrapper_key
          description: "Internal unique identifier from dim_wrapper table."
          tests:
            - not_null
            - relationships:
                to: ref('stg_dim_wrapper')
                field: wrapper_key
        - name: transfer_details_txt
          description: "Details of the transactions."
          tests:
            - not_null
        - name: transfer_amount_gbp_num
          description: "Unit price (in GBP) for the asset at the time of purchase."
          tests:
            - not_null
